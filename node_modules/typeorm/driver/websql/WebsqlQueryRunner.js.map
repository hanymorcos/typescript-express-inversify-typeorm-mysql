{"version":3,"sources":["../../src/driver/websql/WebsqlQueryRunner.ts"],"names":[],"mappings":"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","file":"WebsqlQueryRunner.js","sourcesContent":["import {QueryRunner} from \"../../query-runner/QueryRunner\";\nimport {DatabaseConnection} from \"../DatabaseConnection\";\nimport {ObjectLiteral} from \"../../common/ObjectLiteral\";\nimport {TransactionAlreadyStartedError} from \"../error/TransactionAlreadyStartedError\";\nimport {TransactionNotStartedError} from \"../error/TransactionNotStartedError\";\nimport {Logger} from \"../../logger/Logger\";\nimport {DataTypeNotSupportedByDriverError} from \"../error/DataTypeNotSupportedByDriverError\";\nimport {ColumnSchema} from \"../../schema-builder/schema/ColumnSchema\";\nimport {ColumnMetadata} from \"../../metadata/ColumnMetadata\";\nimport {TableSchema} from \"../../schema-builder/schema/TableSchema\";\nimport {ForeignKeySchema} from \"../../schema-builder/schema/ForeignKeySchema\";\nimport {IndexSchema} from \"../../schema-builder/schema/IndexSchema\";\nimport {QueryRunnerAlreadyReleasedError} from \"../../query-runner/error/QueryRunnerAlreadyReleasedError\";\nimport {WebsqlDriver} from \"./WebsqlDriver\";\nimport {ColumnType} from \"../../metadata/types/ColumnTypes\";\n\n/**\n * Runs queries on a single websql database connection.\n */\nexport class WebsqlQueryRunner implements QueryRunner {\n\n    // -------------------------------------------------------------------------\n    // Protected Properties\n    // -------------------------------------------------------------------------\n\n    /**\n     * Indicates if connection for this query runner is released.\n     * Once its released, query runner cannot run queries anymore.\n     */\n    protected isReleased = false;\n\n    // -------------------------------------------------------------------------\n    // Constructor\n    // -------------------------------------------------------------------------\n\n    constructor(protected databaseConnection: DatabaseConnection,\n                protected driver: WebsqlDriver,\n                protected logger: Logger) {\n    }\n\n    // -------------------------------------------------------------------------\n    // Public Methods\n    // -------------------------------------------------------------------------\n\n    /**\n     * Releases database connection. This is needed when using connection pooling.\n     * If connection is not from a pool, it should not be released.\n     * You cannot use this class's methods after its released.\n     */\n    release(): Promise<void> {\n        if (this.databaseConnection.releaseCallback) {\n            this.isReleased = true;\n            return this.databaseConnection.releaseCallback();\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Removes all tables from the currently connected database.\n     */\n    async clearDatabase(): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        // await this.query(`PRAGMA foreign_keys = OFF;`);\n        await this.beginTransaction();\n        try {\n            const selectDropsQuery = `select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'`;\n            const dropQueries: ObjectLiteral[] = await this.query(selectDropsQuery);\n            await Promise.all(dropQueries.map(q => this.query(q[\"query\"])));\n            await this.commitTransaction();\n\n        } catch (error) {\n            await this.rollbackTransaction();\n            throw error;\n\n        } finally {\n            await this.release();\n            // await this.query(`PRAGMA foreign_keys = ON;`);\n        }\n    }\n\n    /**\n     * Starts transaction.\n     */\n    async beginTransaction(): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        if (this.databaseConnection.isTransactionActive)\n            throw new TransactionAlreadyStartedError();\n\n        this.databaseConnection.isTransactionActive = true;\n        // await this.query(\"BEGIN TRANSACTION\");\n    }\n\n    /**\n     * Commits transaction.\n     */\n    async commitTransaction(): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        if (!this.databaseConnection.isTransactionActive)\n            throw new TransactionNotStartedError();\n\n        // await this.query(\"COMMIT\");\n        this.databaseConnection.isTransactionActive = false;\n    }\n\n    /**\n     * Rollbacks transaction.\n     */\n    async rollbackTransaction(): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        if (!this.databaseConnection.isTransactionActive)\n            throw new TransactionNotStartedError();\n\n        // await this.query(\"ROLLBACK\");\n        this.databaseConnection.isTransactionActive = false;\n    }\n\n    /**\n     * Checks if transaction is in progress.\n     */\n    isTransactionActive(): boolean {\n        return this.databaseConnection.isTransactionActive;\n    }\n\n    /**\n     * Executes a given SQL query.\n     */\n    query(query: string, parameters?: any[]): Promise<any> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        return new Promise((ok, fail) => {\n\n            this.logger.logQuery(query, parameters);\n            const db = this.databaseConnection.connection;\n            // todo: check if transaction is not active\n            db.transaction((tx: any) => {\n                tx.executeSql(query, parameters, (tx: any, result: any) => {\n                    const rows = Object\n                        .keys(result.rows)\n                        .filter(key => key !== \"length\")\n                        .map(key => result.rows[key]);\n                    ok(rows);\n\n                }, (tx: any, err: any) => {\n                    this.logger.logFailedQuery(query, parameters);\n                    this.logger.logQueryError(err);\n                    return fail(err);\n                });\n            });\n        });\n    }\n\n    /**\n     * Insert a new row into given table.\n     */\n    async insert(tableName: string, keyValues: ObjectLiteral, generatedColumn?: ColumnMetadata): Promise<any> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const keys = Object.keys(keyValues);\n        const columns = keys.map(key => this.driver.escapeColumnName(key)).join(\", \");\n        const values = keys.map((key, index) => \"$\" + (index + 1)).join(\",\");\n        const sql = columns.length > 0 ? (`INSERT INTO ${this.driver.escapeTableName(tableName)}(${columns}) VALUES (${values})`) : `INSERT INTO ${this.driver.escapeTableName(tableName)} DEFAULT VALUES`;\n        const parameters = keys.map(key => keyValues[key]);\n\n        return new Promise<any[]>((ok, fail) => {\n            this.logger.logQuery(sql, parameters);\n\n            const db = this.databaseConnection.connection;\n            // todo: check if transaction is not active\n            db.transaction((tx: any) => {\n                tx.executeSql(sql, parameters, (tx: any, result: any) => {\n                    if (generatedColumn)\n                        return ok(result[\"insertId\"]);\n                    ok();\n\n                }, (tx: any, err: any) => {\n                    this.logger.logFailedQuery(sql, parameters);\n                    this.logger.logQueryError(err);\n                    return fail(err);\n                });\n            });\n        });\n    }\n\n    /**\n     * Updates rows that match given conditions in the given table.\n     */\n    async update(tableName: string, valuesMap: ObjectLiteral, conditions: ObjectLiteral): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const updateValues = this.parametrize(valuesMap).join(\", \");\n        const conditionString = this.parametrize(conditions, Object.keys(valuesMap).length).join(\" AND \");\n        const query = `UPDATE ${this.driver.escapeTableName(tableName)} SET ${updateValues} ${conditionString ? (\" WHERE \" + conditionString) : \"\"}`;\n        const updateParams = Object.keys(valuesMap).map(key => valuesMap[key]);\n        const conditionParams = Object.keys(conditions).map(key => conditions[key]);\n        const allParameters = updateParams.concat(conditionParams);\n        await this.query(query, allParameters);\n    }\n\n    /**\n     * Deletes from the given table by a given conditions.\n     */\n    async delete(tableName: string, condition: string, parameters?: any[]): Promise<void>;\n\n    /**\n     * Deletes from the given table by a given conditions.\n     */\n    async delete(tableName: string, conditions: ObjectLiteral): Promise<void>;\n\n    /**\n     * Deletes from the given table by a given conditions.\n     */\n    async delete(tableName: string, conditions: ObjectLiteral|string, maybeParameters?: any[]): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const conditionString = typeof conditions === \"string\" ? conditions : this.parametrize(conditions).join(\" AND \");\n        const parameters = conditions instanceof Object ? Object.keys(conditions).map(key => (conditions as ObjectLiteral)[key]) : maybeParameters;\n\n        const sql = `DELETE FROM ${this.driver.escapeTableName(tableName)} WHERE ${conditionString}`;\n        await this.query(sql, parameters);\n    }\n\n    /**\n     * Inserts rows into closure table.\n     */\n    async insertIntoClosureTable(tableName: string, newEntityId: any, parentId: any, hasLevel: boolean): Promise<number> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        let sql = \"\";\n        if (hasLevel) {\n            sql = `INSERT INTO ${this.driver.escapeTableName(tableName)}(ancestor, descendant, level) ` +\n                `SELECT ancestor, ${newEntityId}, level + 1 FROM ${this.driver.escapeTableName(tableName)} WHERE descendant = ${parentId} ` +\n                `UNION ALL SELECT ${newEntityId}, ${newEntityId}, 1`;\n        } else {\n            sql = `INSERT INTO ${this.driver.escapeTableName(tableName)}(ancestor, descendant) ` +\n                `SELECT ancestor, ${newEntityId} FROM ${this.driver.escapeTableName(tableName)} WHERE descendant = ${parentId} ` +\n                `UNION ALL SELECT ${newEntityId}, ${newEntityId}`;\n        }\n        await this.query(sql);\n        const results: ObjectLiteral[] = await this.query(`SELECT MAX(level) as level FROM ${tableName} WHERE descendant = ${parentId}`);\n        return results && results[0] && results[0][\"level\"] ? parseInt(results[0][\"level\"]) + 1 : 1;\n    }\n\n    /**\n     * Loads given table's data from the database.\n     */\n    async loadTableSchema(tableName: string): Promise<TableSchema|undefined> {\n        const tableSchemas = await this.loadTableSchemas([tableName]);\n        return tableSchemas.length > 0 ? tableSchemas[0] : undefined;\n    }\n\n    /**\n     * Loads all tables (with given names) from the database and creates a TableSchema from them.\n     */\n    async loadTableSchemas(tableNames: string[]): Promise<TableSchema[]> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        // if no tables given then no need to proceed\n\n        if (!tableNames || !tableNames.length)\n            return [];\n\n        const tableNamesString = tableNames.map(tableName => `'${tableName}'`).join(\", \");\n\n        // load tables, columns, indices and foreign keys\n        const dbTables: ObjectLiteral[] = await this.query(`SELECT * FROM sqlite_master WHERE type = 'table' AND name IN (${tableNamesString})`);\n\n        // if tables were not found in the db, no need to proceed\n        if (!dbTables || !dbTables.length)\n            return [];\n\n        // create table schemas for loaded tables\n        return Promise.all(dbTables.map(async dbTable => {\n            const tableSchema = new TableSchema(dbTable[\"name\"]);\n\n            // load columns and indices\n            /*const [dbColumns, dbIndices, dbForeignKeys]: ObjectLiteral[][] = await Promise.all([\n                this.query(`PRAGMA table_info(\"${dbTable[\"name\"]}\")`),\n                this.query(`PRAGMA index_list(\"${dbTable[\"name\"]}\")`),\n                this.query(`PRAGMA foreign_key_list(\"${dbTable[\"name\"]}\")`),\n            ]);\n\n            // find column name with auto increment\n            let autoIncrementColumnName: string|undefined = undefined;\n            const tableSql: string = dbTable[\"sql\"];\n            if (tableSql.indexOf(\"AUTOINCREMENT\") !== -1) {\n                autoIncrementColumnName = tableSql.substr(0, tableSql.indexOf(\"AUTOINCREMENT\"));\n                const comma = autoIncrementColumnName.lastIndexOf(\",\");\n                const bracket = autoIncrementColumnName.lastIndexOf(\"(\");\n                if (comma !== -1) {\n                    autoIncrementColumnName = autoIncrementColumnName.substr(comma);\n                    autoIncrementColumnName = autoIncrementColumnName.substr(0, autoIncrementColumnName.lastIndexOf(\"\\\"\"));\n                    autoIncrementColumnName = autoIncrementColumnName.substr(autoIncrementColumnName.indexOf(\"\\\"\") + 1);\n\n                } else if (bracket !== -1) {\n                    autoIncrementColumnName = autoIncrementColumnName.substr(bracket);\n                    autoIncrementColumnName = autoIncrementColumnName.substr(0, autoIncrementColumnName.lastIndexOf(\"\\\"\"));\n                    autoIncrementColumnName = autoIncrementColumnName.substr(autoIncrementColumnName.indexOf(\"\\\"\") + 1);\n                }\n            }\n\n            // create column schemas from the loaded columns\n            tableSchema.columns = dbColumns.map(dbColumn => {\n                const columnSchema = new ColumnSchema();\n                columnSchema.name = dbColumn[\"name\"];\n                columnSchema.type = dbColumn[\"type\"].toLowerCase();\n                columnSchema.default = dbColumn[\"dflt_value\"] !== null && dbColumn[\"dflt_value\"] !== undefined ? dbColumn[\"dflt_value\"] : undefined;\n                columnSchema.isNullable = dbColumn[\"notnull\"] === 0;\n                columnSchema.isPrimary = dbColumn[\"pk\"] === 1;\n                columnSchema.comment = \"\"; // todo later\n                columnSchema.isGenerated = autoIncrementColumnName === dbColumn[\"name\"];\n                const columnForeignKeys = dbForeignKeys\n                    .filter(foreignKey => foreignKey[\"from\"] === dbColumn[\"name\"])\n                    .map(foreignKey => {\n                        const keyName = namingStrategy.foreignKeyName(dbTable[\"name\"], [foreignKey[\"from\"]], foreignKey[\"table\"], [foreignKey[\"to\"]]);\n                        return new ForeignKeySchema(keyName, [foreignKey[\"from\"]], [foreignKey[\"to\"]], foreignKey[\"table\"], foreignKey[\"on_delete\"]); // todo: how sqlite return from and to when they are arrays? (multiple column foreign keys)\n                    });\n                tableSchema.addForeignKeys(columnForeignKeys);\n                return columnSchema;\n            });\n\n            // create primary key schema\n            await Promise.all(dbIndices\n                .filter(index => index[\"origin\"] === \"pk\")\n                .map(async index => {\n                    const indexInfos: ObjectLiteral[] = await this.query(`PRAGMA index_info(\"${index[\"name\"]}\")`);\n                    const indexColumns = indexInfos.map(indexInfo => indexInfo[\"name\"]);\n                    indexColumns.forEach(indexColumn => {\n                        tableSchema.primaryKeys.push(new PrimaryKeySchema(index[\"name\"], indexColumn));\n                    });\n                }));\n\n            // create index schemas from the loaded indices\n            const indicesPromises = dbIndices\n                .filter(dbIndex => {\n                    return  dbIndex[\"origin\"] !== \"pk\" &&\n                        (!tableSchema.foreignKeys.find(foreignKey => foreignKey.name === dbIndex[\"name\"])) &&\n                        (!tableSchema.primaryKeys.find(primaryKey => primaryKey.name === dbIndex[\"name\"]));\n                })\n                .map(dbIndex => dbIndex[\"name\"])\n                .filter((value, index, self) => self.indexOf(value) === index) // unqiue\n                .map(async dbIndexName => {\n                    const dbIndex = dbIndices.find(dbIndex => dbIndex[\"name\"] === dbIndexName);\n                    const indexInfos: ObjectLiteral[] = await this.query(`PRAGMA index_info(\"${dbIndex![\"name\"]}\")`);\n                    const indexColumns = indexInfos.map(indexInfo => indexInfo[\"name\"]);\n\n                    // check if db index is generated by sqlite itself and has special use case\n                    if (dbIndex![\"name\"].substr(0, \"sqlite_autoindex\".length) === \"sqlite_autoindex\") {\n                        if (dbIndex![\"unique\"] === 1) { // this means we have a special index generated for a column\n                            // so we find and update the column\n                            indexColumns.forEach(columnName => {\n                                const column = tableSchema.columns.find(column => column.name === columnName);\n                                if (column)\n                                    column.isUnique = true;\n                            });\n                        }\n\n                        return Promise.resolve(undefined);\n\n                    } else {\n                        return new IndexSchema(dbTable[\"name\"], dbIndex![\"name\"], indexColumns, dbIndex![\"unique\"] === \"1\");\n                    }\n                });\n\n            const indices = await Promise.all(indicesPromises);\n            tableSchema.indices = indices.filter(index => !!index) as IndexSchema[];*/\n\n            return tableSchema;\n        }));\n    }\n\n    /**\n     * Checks if table with the given name exist in the database.\n     */\n    async hasTable(tableName: string): Promise<boolean> {\n        const sql = `SELECT * FROM sqlite_master WHERE type = 'table' AND name = ${tableName}'`;\n        const result = await this.query(sql);\n        return result.length ? true : false;\n    }\n\n    /**\n     * Creates a new table from the given table metadata and column metadatas.\n     */\n    async createTable(table: TableSchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        // skip columns with foreign keys, we will add them later\n        const columnDefinitions = table.columns.map(column => this.buildCreateColumnSql(column)).join(\", \");\n        let sql = `CREATE TABLE \"${table.name}\" (${columnDefinitions}`;\n        const primaryKeyColumns = table.columns.filter(column => column.isPrimary && !column.isGenerated);\n        if (primaryKeyColumns.length > 0)\n            sql += `, PRIMARY KEY(${primaryKeyColumns.map(column => `${column.name}`).join(\", \")})`; // for some reason column escaping here generates a wrong schema\n        sql += `)`;\n        await this.query(sql);\n    }\n\n    /**\n     * Checks if column with the given name exist in the given table.\n     */\n    async hasColumn(tableName: string, columnName: string): Promise<boolean> {\n        const sql = `PRAGMA table_info(\"${tableName}\")`;\n        const columns: ObjectLiteral[] = await this.query(sql);\n        return !!columns.find(column => column[\"name\"] === columnName);\n    }\n\n    /**\n     * Creates a new column from the column schema in the table.\n     */\n    async addColumn(tableName: string, column: ColumnSchema): Promise<void>;\n\n    /**\n     * Creates a new column from the column schema in the table.\n     */\n    async addColumn(tableSchema: TableSchema, column: ColumnSchema): Promise<void>;\n\n    /**\n     * Creates a new column from the column schema in the table.\n     */\n    async addColumn(tableSchemaOrName: TableSchema|string, column: ColumnSchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const tableSchema = await this.getTableSchema(tableSchemaOrName);\n        const newTableSchema = tableSchema.clone();\n        newTableSchema.addColumns([column]);\n        await this.recreateTable(newTableSchema, tableSchema);\n    }\n\n    /**\n     * Creates a new columns from the column schema in the table.\n     */\n    async addColumns(tableName: string, columns: ColumnSchema[]): Promise<void>;\n\n    /**\n     * Creates a new columns from the column schema in the table.\n     */\n    async addColumns(tableSchema: TableSchema, columns: ColumnSchema[]): Promise<void>;\n\n    /**\n     * Creates a new columns from the column schema in the table.\n     */\n    async addColumns(tableSchemaOrName: TableSchema|string, columns: ColumnSchema[]): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const tableSchema = await this.getTableSchema(tableSchemaOrName);\n        const newTableSchema = tableSchema.clone();\n        newTableSchema.addColumns(columns);\n        await this.recreateTable(newTableSchema, tableSchema);\n    }\n\n    /**\n     * Renames column in the given table.\n     */\n    renameColumn(table: TableSchema, oldColumn: ColumnSchema, newColumn: ColumnSchema): Promise<void>;\n\n    /**\n     * Renames column in the given table.\n     */\n    renameColumn(tableName: string, oldColumnName: string, newColumnName: string): Promise<void>;\n\n    /**\n     * Renames column in the given table.\n     */\n    async renameColumn(tableSchemaOrName: TableSchema|string, oldColumnSchemaOrName: ColumnSchema|string, newColumnSchemaOrName: ColumnSchema|string): Promise<void> {\n\n        let tableSchema: TableSchema|undefined = undefined;\n        if (tableSchemaOrName instanceof TableSchema) {\n            tableSchema = tableSchemaOrName;\n        } else {\n            tableSchema = await this.loadTableSchema(tableSchemaOrName);\n        }\n\n        if (!tableSchema)\n            throw new Error(`Table ${tableSchemaOrName} was not found.`);\n\n        let oldColumn: ColumnSchema|undefined = undefined;\n        if (oldColumnSchemaOrName instanceof ColumnSchema) {\n            oldColumn = oldColumnSchemaOrName;\n        } else {\n            oldColumn = tableSchema.columns.find(column => column.name === oldColumnSchemaOrName);\n        }\n\n        if (!oldColumn)\n            throw new Error(`Column \"${oldColumnSchemaOrName}\" was not found in the \"${tableSchemaOrName}\" table.`);\n\n        let newColumn: ColumnSchema|undefined = undefined;\n        if (newColumnSchemaOrName instanceof ColumnSchema) {\n            newColumn = newColumnSchemaOrName;\n        } else {\n            newColumn = oldColumn.clone();\n            newColumn.name = newColumnSchemaOrName;\n        }\n\n        return this.changeColumn(tableSchema, oldColumn, newColumn);\n    }\n\n    /**\n     * Changes a column in the table.\n     */\n    changeColumn(tableSchema: TableSchema, oldColumn: ColumnSchema, newColumn: ColumnSchema): Promise<void>;\n\n    /**\n     * Changes a column in the table.\n     */\n    changeColumn(tableSchema: string, oldColumn: string, newColumn: ColumnSchema): Promise<void>;\n\n    /**\n     * Changes a column in the table.\n     */\n    async changeColumn(tableSchemaOrName: TableSchema|string, oldColumnSchemaOrName: ColumnSchema|string, newColumn: ColumnSchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        let tableSchema: TableSchema|undefined = undefined;\n        if (tableSchemaOrName instanceof TableSchema) {\n            tableSchema = tableSchemaOrName;\n        } else {\n            tableSchema = await this.loadTableSchema(tableSchemaOrName);\n        }\n\n        if (!tableSchema)\n            throw new Error(`Table ${tableSchemaOrName} was not found.`);\n\n        let oldColumn: ColumnSchema|undefined = undefined;\n        if (oldColumnSchemaOrName instanceof ColumnSchema) {\n            oldColumn = oldColumnSchemaOrName;\n        } else {\n            oldColumn = tableSchema.columns.find(column => column.name === oldColumnSchemaOrName);\n        }\n\n        if (!oldColumn)\n            throw new Error(`Column \"${oldColumnSchemaOrName}\" was not found in the \"${tableSchemaOrName}\" table.`);\n\n        // todo: fix it. it should not depend on tableSchema\n        return this.recreateTable(tableSchema);\n    }\n\n    /**\n     * Changes a column in the table.\n     * Changed column looses all its keys in the db.\n     */\n    async changeColumns(tableSchema: TableSchema, changedColumns: { newColumn: ColumnSchema, oldColumn: ColumnSchema }[]): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        // todo: fix it. it should not depend on tableSchema\n        return this.recreateTable(tableSchema);\n    }\n\n    /**\n     * Drops column in the table.\n     */\n    async dropColumn(tableName: string, columnName: string): Promise<void>;\n\n    /**\n     * Drops column in the table.\n     */\n    async dropColumn(tableSchema: TableSchema, column: ColumnSchema): Promise<void>;\n\n    /**\n     * Drops column in the table.\n     */\n    async dropColumn(tableSchemaOrName: TableSchema|string, columnSchemaOrName: ColumnSchema|string): Promise<void> {\n        return this.dropColumns(tableSchemaOrName as any, [columnSchemaOrName as any]);\n    }\n\n    /**\n     * Drops the columns in the table.\n     */\n    async dropColumns(tableName: string, columnNames: string[]): Promise<void>;\n\n    /**\n     * Drops the columns in the table.\n     */\n    async dropColumns(tableSchema: TableSchema, columns: ColumnSchema[]): Promise<void>;\n\n    /**\n     * Drops the columns in the table.\n     */\n    async dropColumns(tableSchemaOrName: TableSchema|string, columnSchemasOrNames: ColumnSchema[]|string[]): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const tableSchema = await this.getTableSchema(tableSchemaOrName);\n        const updatingTableSchema = tableSchema.clone();\n        const columns = (columnSchemasOrNames as any[]).map(columnSchemasOrName => {\n            if (typeof columnSchemasOrName === \"string\") {\n                const column = tableSchema.columns.find(column => column.name === columnSchemasOrName);\n                if (!column)\n                    throw new Error(`Cannot drop a column - column \"${columnSchemasOrName}\" was not found in the \"${tableSchema.name}\" table.`);\n\n                return column;\n\n            } else {\n                return columnSchemasOrName as ColumnSchema;\n            }\n        });\n        updatingTableSchema.removeColumns(columns);\n        return this.recreateTable(updatingTableSchema);\n    }\n\n    /**\n     * Updates table's primary keys.\n     */\n    async updatePrimaryKeys(dbTable: TableSchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        return this.recreateTable(dbTable);\n    }\n\n    /**\n     * Creates a new foreign key.\n     */\n    async createForeignKey(tableName: string, foreignKey: ForeignKeySchema): Promise<void>;\n\n    /**\n     * Creates a new foreign key.\n     */\n    async createForeignKey(tableSchema: TableSchema, foreignKey: ForeignKeySchema): Promise<void>;\n\n    /**\n     * Creates a new foreign key.\n     */\n    async createForeignKey(tableSchemaOrName: TableSchema|string, foreignKey: ForeignKeySchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        return this.createForeignKeys(tableSchemaOrName as any, [foreignKey]);\n    }\n\n    /**\n     * Creates a new foreign keys.\n     */\n    async createForeignKeys(tableName: string, foreignKeys: ForeignKeySchema[]): Promise<void>;\n\n    /**\n     * Creates a new foreign keys.\n     */\n    async createForeignKeys(tableSchema: TableSchema, foreignKeys: ForeignKeySchema[]): Promise<void>;\n\n    /**\n     * Creates a new foreign keys.\n     */\n    async createForeignKeys(tableSchemaOrName: TableSchema|string, foreignKeys: ForeignKeySchema[]): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const tableSchema = await this.getTableSchema(tableSchemaOrName);\n        const changedTableSchema = tableSchema.clone();\n        changedTableSchema.addForeignKeys(foreignKeys);\n        return this.recreateTable(changedTableSchema);\n    }\n\n    /**\n     * Drops a foreign key from the table.\n     */\n    async dropForeignKey(tableName: string, foreignKey: ForeignKeySchema): Promise<void>;\n\n    /**\n     * Drops a foreign key from the table.\n     */\n    async dropForeignKey(tableSchema: TableSchema, foreignKey: ForeignKeySchema): Promise<void>;\n\n    /**\n     * Drops a foreign key from the table.\n     */\n    async dropForeignKey(tableSchemaOrName: TableSchema|string, foreignKey: ForeignKeySchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        return this.dropForeignKeys(tableSchemaOrName as any, [foreignKey]);\n    }\n\n    /**\n     * Drops a foreign keys from the table.\n     */\n    async dropForeignKeys(tableName: string, foreignKeys: ForeignKeySchema[]): Promise<void>;\n\n    /**\n     * Drops a foreign keys from the table.\n     */\n    async dropForeignKeys(tableSchema: TableSchema, foreignKeys: ForeignKeySchema[]): Promise<void>;\n\n    /**\n     * Drops a foreign keys from the table.\n     */\n    async dropForeignKeys(tableSchemaOrName: TableSchema|string, foreignKeys: ForeignKeySchema[]): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const tableSchema = await this.getTableSchema(tableSchemaOrName);\n        const changedTableSchema = tableSchema.clone();\n        changedTableSchema.removeForeignKeys(foreignKeys);\n        return this.recreateTable(changedTableSchema);\n    }\n\n    /**\n     * Creates a new index.\n     */\n    async createIndex(tableName: string, index: IndexSchema): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const columnNames = index.columnNames.map(columnName => `\"${columnName}\"`).join(\",\");\n        const sql = `CREATE ${index.isUnique ? \"UNIQUE \" : \"\"}INDEX \"${index.name}\" ON \"${tableName}\"(${columnNames})`;\n        await this.query(sql);\n    }\n\n    /**\n     * Drops an index from the table.\n     */\n    async dropIndex(tableName: string, indexName: string): Promise<void> {\n        if (this.isReleased)\n            throw new QueryRunnerAlreadyReleasedError();\n\n        const sql = `DROP INDEX \"${indexName}\"`;\n        await this.query(sql);\n    }\n\n    /**\n     * Creates a database type from a given column metadata.\n     */\n    normalizeType(typeOptions: { type: ColumnType, length?: string|number, precision?: number, scale?: number, timezone?: boolean }) {\n        switch (typeOptions.type) {\n            case \"string\":\n                return \"character varying(\" + (typeOptions.length ? typeOptions.length : 255) + \")\";\n            case \"text\":\n                return \"text\";\n            case \"boolean\":\n                return \"boolean\";\n            case \"integer\":\n            case \"int\":\n                return \"integer\";\n            case \"smallint\":\n                return \"smallint\";\n            case \"bigint\":\n                return \"bigint\";\n            case \"float\":\n                return \"real\";\n            case \"double\":\n            case \"number\":\n                return \"double precision\";\n            case \"decimal\":\n                if (typeOptions.precision && typeOptions.scale) {\n                    return `decimal(${typeOptions.precision},${typeOptions.scale})`;\n\n                } else if (typeOptions.scale) {\n                    return `decimal(${typeOptions.scale})`;\n\n                } else if (typeOptions.precision) {\n                    return `decimal(${typeOptions.precision})`;\n\n                } else {\n                    return \"decimal\";\n\n                }\n            case \"date\":\n                return \"date\";\n            case \"time\":\n                if (typeOptions.timezone) {\n                    return \"time with time zone\";\n                } else {\n                    return \"time without time zone\";\n                }\n            case \"datetime\":\n                if (typeOptions.timezone) {\n                    return \"timestamp with time zone\";\n                } else {\n                    return \"timestamp without time zone\";\n                }\n            case \"json\":\n                return \"json\";\n            case \"simple_array\":\n                return typeOptions.length ? \"character varying(\" + typeOptions.length + \")\" : \"text\";\n        }\n\n        throw new DataTypeNotSupportedByDriverError(typeOptions.type, \"WebSQL\");\n    }\n\n    /**\n     * Checks if \"DEFAULT\" values in the column metadata and in the database schema are equal.\n     */\n    compareDefaultValues(columnMetadataValue: any, databaseValue: any): boolean {\n\n        if (typeof columnMetadataValue === \"number\")\n            return columnMetadataValue === parseInt(databaseValue);\n        if (typeof columnMetadataValue === \"boolean\")\n            return columnMetadataValue === (!!databaseValue || databaseValue === \"false\");\n        if (typeof columnMetadataValue === \"function\")\n            return columnMetadataValue() === databaseValue;\n\n        return columnMetadataValue === databaseValue;\n    }\n\n    /**\n     * Truncates table.\n     */\n    async truncate(tableName: string): Promise<void> {\n        await this.query(`DELETE FROM ${this.driver.escapeTableName(tableName)}`);\n    }\n\n    // -------------------------------------------------------------------------\n    // Protected Methods\n    // -------------------------------------------------------------------------\n\n    /**\n     * Parametrizes given object of values. Used to create column=value queries.\n     */\n    protected parametrize(objectLiteral: ObjectLiteral, startIndex: number = 0): string[] {\n        return Object.keys(objectLiteral).map((key, index) => this.driver.escapeColumnName(key) + \"=$\" + (startIndex + index + 1));\n    }\n\n    /**\n     * Builds a query for create column.\n     */\n    protected buildCreateColumnSql(column: ColumnSchema): string {\n        let c = \"\\\"\" + column.name + \"\\\"\";\n        if (column instanceof ColumnMetadata) {\n            c += \" \" + this.normalizeType(column);\n        } else {\n            c += \" \" + column.type;\n        }\n        if (column.isNullable !== true)\n            c += \" NOT NULL\";\n        if (column.isUnique === true)\n            c += \" UNIQUE\";\n        if (column.isGenerated === true) // don't use skipPrimary here since updates can update already exist primary without auto inc.\n            c += \" PRIMARY KEY AUTOINCREMENT\";\n        if (column.default !== undefined && column.default !== null) { // todo: same code in all drivers. make it DRY\n            if (typeof column.default === \"number\") {\n                c += \" DEFAULT \" + column.default + \"\";\n            } else if (typeof column.default === \"boolean\") {\n                c += \" DEFAULT \" + (column.default === true ? \"TRUE\" : \"FALSE\") + \"\";\n            } else if (typeof column.default === \"function\") {\n                c += \" DEFAULT \" + column.default() + \"\";\n            } else if (typeof column.default === \"string\") {\n                c += \" DEFAULT '\" + column.default + \"'\";\n            } else {\n                c += \" DEFAULT \" + column.default + \"\";\n            }\n        }\n\n        return c;\n    }\n\n    protected async recreateTable(tableSchema: TableSchema, oldTableSchema?: TableSchema): Promise<void> {\n        // const withoutForeignKeyColumns = columns.filter(column => column.foreignKeys.length === 0);\n        // const createForeignKeys = options && options.createForeignKeys;\n        const columnDefinitions = tableSchema.columns.map(dbColumn => this.buildCreateColumnSql(dbColumn)).join(\", \");\n        const columnNames = tableSchema.columns.map(column => `\"${column.name}\"`).join(\", \");\n\n        let sql1 = `CREATE TABLE \"temporary_${tableSchema.name}\" (${columnDefinitions}`;\n        // if (options && options.createForeignKeys) {\n        tableSchema.foreignKeys.forEach(foreignKey => {\n            const columnNames = foreignKey.columnNames.map(name => `\"${name}\"`).join(\", \");\n            const referencedColumnNames = foreignKey.referencedColumnNames.map(name => `\"${name}\"`).join(\", \");\n            sql1 += `, FOREIGN KEY(${columnNames}) REFERENCES \"${foreignKey.referencedTableName}\"(${referencedColumnNames})`;\n            if (foreignKey.onDelete) sql1 += \" ON DELETE \" + foreignKey.onDelete;\n        });\n\n        const primaryKeyColumns = tableSchema.columns.filter(column => column.isPrimary && !column.isGenerated);\n        if (primaryKeyColumns.length > 0)\n            sql1 += `, PRIMARY KEY(${primaryKeyColumns.map(column => `${column.name}`).join(\", \")})`; // for some reason column escaping here generate a wrong schema\n\n        sql1 += \")\";\n\n        // todo: need also create uniques and indices?\n\n        // recreate a table with a temporary name\n        await this.query(sql1);\n\n        // we need only select data from old columns\n        const oldColumnNames = oldTableSchema ? oldTableSchema.columns.map(column => `\"${column.name}\"`).join(\", \") : columnNames;\n\n        // migrate all data from the table into temporary table\n        const sql2 = `INSERT INTO \"temporary_${tableSchema.name}\"(${oldColumnNames}) SELECT ${oldColumnNames} FROM \"${tableSchema.name}\"`;\n        await this.query(sql2);\n\n        // drop old table\n        const sql3 = `DROP TABLE \"${tableSchema.name}\"`;\n        await this.query(sql3);\n\n        // rename temporary table\n        const sql4 = `ALTER TABLE \"temporary_${tableSchema.name}\" RENAME TO \"${tableSchema.name}\"`;\n        await this.query(sql4);\n\n        // also re-create indices\n        const indexPromises = tableSchema.indices.map(index => this.createIndex(tableSchema.name, index));\n        // const uniquePromises = tableSchema.uniqueKeys.map(key => this.createIndex(key));\n        await Promise.all(indexPromises/*.concat(uniquePromises)*/);\n    }\n\n    /**\n     * If given value is a table name then it loads its table schema representation from the database.\n     */\n    protected async getTableSchema(tableSchemaOrName: TableSchema|string): Promise<TableSchema> {\n        if (tableSchemaOrName instanceof TableSchema) {\n            return tableSchemaOrName;\n        } else {\n            const tableSchema = await this.loadTableSchema(tableSchemaOrName);\n            if (!tableSchema)\n                throw new Error(`Table named ${tableSchemaOrName} was not found in the database.`);\n\n            return tableSchema;\n        }\n    }\n\n}"],"sourceRoot":"../.."}